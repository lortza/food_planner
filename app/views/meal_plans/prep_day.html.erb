<% content_for(:title, "Prep Day #{@meal_plan.prepared_on}") %>
<% content_for :full_width, true %>

<div class="container-navbar-padding">
  <div class="flex flex-row justify-content-between mb-3">
  <p><%= link_to MaterialIcon.new(icon: :arrow_left).render + "Meal Plans", meal_plans_path %></p>
  <p><%= link_to "Toggle View", meal_plan_path(@meal_plan) %></p>
</div>

  <h1>
    <%= link_to MaterialIcon.new(icon: :settings, title: 'Edit', classes: 'float-end').render, edit_meal_plan_path(@meal_plan) %>
    Meal Plan for <%= @meal_plan.prepared_on.to_fs(:long) %>
  </h1>
  <p>
    Yield: <%= @meal_plan.total_servings %> (<%= @meal_plan.meals %> Meals for <%= @meal_plan.people_served %> People) |
    Total Prep Time: <%= display_time(@meal_plan.total_prep_time) %> |
    Total Cook Time: <%= display_time(@meal_plan.total_cook_time) %> |
    Total Time: <%= display_time(@meal_plan.total_time) %>
  </p>
  <p>
    <% if @meal_plan.notes.present? %>
      Notes: <%= @meal_plan.notes %>
    <% end %>
  </p>
  <hr>

  <!-- Recipe toggles -->
  <div class="mb-3">
    <strong>Select Recipes:</strong>
    <% @meal_plan.recipes.each do |recipe| %>
      <div class="form-check form-check-inline">
        <input class="form-check-input recipe-toggle-checkbox" type="checkbox" id="recipe-checkbox-<%= recipe.id %>" value="<%= recipe.id %>" checked>
        <label class="form-check-label" for="recipe-checkbox-<%= recipe.id %>">
          <%= recipe.title %>
        </label>
      </div>
    <% end %>
  </div>

  <!-- Recipe columns -->
  <div class="flex flex-row gap-30" id="recipe-columns-container">
    <% @meal_plan.recipes.each do |recipe| %>
    <%= tag.section id: "recipe-column-#{recipe.id}", class: "recipe-column overflow-scroll max-vh-80 flex-1", data: { recipe_id: recipe.id } do %>
      <h2 class="sticky-top bg-white">
        <%= link_to recipe.title, recipe_path(recipe) %>  <%= extra_work_flag(recipe) %> <%= status_flag(recipe) %>
      </h2>
      <p>
        <small>Yield <%= recipe.servings %> | <%= display_time(recipe.prep_time) %> prep | <%= display_time(recipe.cook_time) %> cook | <%= display_time(recipe.total_time) %> total</small>
      </p>

      <% if recipe.notes.present? %>
        <h2>Notes</h2>
        <p><%= recipe.notes %></p>
      <% end %>

      <h3>Ingredients</h3>
      <div class='ms-3 mb-4'>
        <% recipe.ingredients.by_id.each do |ingredient| %>
          <input type="checkbox">
          <label class="mb-0 inline"><%= ingredient_display(ingredient) %></label><br>
        <% end %>
      </div>

      <h3>Instructions</h3>
      <div id="js-instructions" class="card mb-5">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <%= link_to "Prep Day", "#prep-day-#{recipe.id}", class: "nav-link active", id: "prep-tab-#{recipe.id}", "aria-controls": "prep-day-#{recipe.id}", "aria-selected": "true", data: { bs_toggle: "tab", bs_target: "#prep-day-#{recipe.id}" } %>
            </li>
            <li class="nav-item">
              <%= link_to "Original", "#original-#{recipe.id}", class: "nav-link", id: "original-tab-#{recipe.id}", "aria-controls": "original-#{recipe.id}", "aria-selected": "false", data: { bs_toggle: "tab", bs_target: "#original-#{recipe.id}" } %>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="prep-day-<%= recipe.id %>" role="tabpanel" aria-labelledby="prep-day-tab-<%= recipe.id %>">
              <ol>
                <%= simple_format(recipe.prep_day_instructions, {}, wrapper_tag: 'li') %>
              </ol>
            </div>

            <div class="tab-pane fade" id="original-<%= recipe.id %>" role="tabpanel" aria-labelledby="original-tab-<%= recipe.id %>">
              <ol>
                <%= simple_format(recipe.instructions, {}, wrapper_tag: 'li') %>
              </ol>
            </div>
          </div><!-- tab-content -->
        </div><!-- card body -->
      </div><!-- card -->
     <% end %><!-- section -->
    <% end %>
  </div>
</div>
